<!DOCTYPE html>
<html lang=zh-CN>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="sogou_site_verification" content="rZCOURJedr">
  <meta name="baidu-site-verification" content="MHKqWQPYmp">
  <meta name="google-site-verification" content="7_5x-cd73n3XFQt0nK2XOiOASPW_RyZRDBEXcUiB0nY">
  <meta name="msvalidate.01" content="85212EBB223945AE5D88E54E3D5B5E64">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content>
  <meta name="keywords" content="ArcGIS,Leaflet,GeoServer,PostGIS,Python">
  
    <link rel="icon" href="/favicon.ico">
  
    
  <title>VUE3预览图片和视频 | Hello Map</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/lib/jquery.fancybox.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>Hello Map</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>VUE3预览图片和视频</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2021年09月13日</time>
            
            
              | 
                  <i class="fa fa-tags" aria-hidden="true"></i>
                
               
  <a href="/tags/#前端" class='tag'>前端</a>

  <a href="/tags/#VUE" class='tag'>VUE</a>


            
          </div>
          <p>项目中遇到一组数据既有可能是图片，也有可能是视频，需要同时预览的情况，搜了一下，找到了<a href="https://github.com/RobinCK/vue-gallery" target="_blank" rel="noopener">vue-gallery</a>，试了一下之后发现没法在VUE3下没法用，不知道是真的完全没法用，还是因为我用的Composition API才没法用，没去纠结。</p>
<p>没找到其他的，只好自力更生，但是也没有完全自力更生。我留意到了<a href="https://element-plus.gitee.io/" target="_blank" rel="noopener">Element Plus</a>的Image组件是可以大图预览的，毕竟Element Plus是开源的，只要稍微改一下，对图片和视频资源做一个判断，然后分别显示img和video不就可以了。于是我找到了Element Plus的image-viewer的源码，做了一下修改，核心的修改地方如上面所说的，加了判断和video</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"el-image-viewer__canvas"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">		<span class="attr">v-for</span>=<span class="string">"(url, i) in urlList"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">v-show</span>=<span class="string">"i === index &amp;&amp; isImage"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">ref</span>=<span class="string">"media"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:key</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:src</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:style</span>=<span class="string">"mediaStyle"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"el-image-viewer__img"</span></span></span><br><span class="line"><span class="tag">		@<span class="attr">load</span>=<span class="string">"handleMediaLoad"</span></span></span><br><span class="line"><span class="tag">		@<span class="attr">error</span>=<span class="string">"handleMediaError"</span></span></span><br><span class="line"><span class="tag">		@<span class="attr">mousedown</span>=<span class="string">"handleMouseDown"</span></span></span><br><span class="line"><span class="tag">	/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">video</span></span></span><br><span class="line"><span class="tag">		<span class="attr">controls</span>=<span class="string">"controls"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">v-for</span>=<span class="string">"(url, i) in urlList"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">v-show</span>=<span class="string">"i === index &amp;&amp; isVideo"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">ref</span>=<span class="string">"media"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:key</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:src</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:style</span>=<span class="string">"mediaStyle"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"el-image-viewer__img"</span></span></span><br><span class="line"><span class="tag">		@<span class="attr">load</span>=<span class="string">"handleMediaLoad"</span></span></span><br><span class="line"><span class="tag">		@<span class="attr">error</span>=<span class="string">"handleMediaError"</span></span></span><br><span class="line"><span class="tag">		@<span class="attr">mousedown</span>=<span class="string">"handleMouseDown"</span></span></span><br><span class="line"><span class="tag">	&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后把图片预览的相关操作比如放大缩小旋转等工具条在视频的时候给隐藏，把Element Plus的部分ts语法改成js，部分工具函数给拿出来，事件函数on和off给重写下，就完事了，完整代码如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">"viewer-fade"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ref</span>=<span class="string">"wrapper"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:tabindex</span>=<span class="string">"-1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">"el-image-viewer__wrapper"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:style</span>=<span class="string">"&#123; zIndex &#125;"</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"el-image-viewer__mask"</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">click.self</span>=<span class="string">"hideOnClickModal &amp;&amp; hide()"</span></span></span><br><span class="line"><span class="tag">            &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- CLOSE --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"el-image-viewer__btn el-image-viewer__close"</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">click</span>=<span class="string">"hide"</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-close"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ARROW --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">"!isSingle"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">"el-image-viewer__btn el-image-viewer__prev"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:class</span>=<span class="string">"&#123; 'is-disabled': !infinite &amp;&amp; isFirst &#125;"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">click</span>=<span class="string">"prev"</span></span></span><br><span class="line"><span class="tag">                &gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-arrow-left"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">"el-image-viewer__btn el-image-viewer__next"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:class</span>=<span class="string">"&#123; 'is-disabled': !infinite &amp;&amp; isLast &#125;"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">click</span>=<span class="string">"next"</span></span></span><br><span class="line"><span class="tag">                &gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-arrow-right"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ACTIONS --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">                <span class="attr">v-if</span>=<span class="string">"isImage"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">class</span>=<span class="string">"el-image-viewer__btn el-image-viewer__actions"</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"el-image-viewer__actions__inner"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">class</span>=<span class="string">"el-icon-zoom-out"</span></span></span><br><span class="line"><span class="tag">                        @<span class="attr">click</span>=<span class="string">"handleActions('zoomOut')"</span></span></span><br><span class="line"><span class="tag">                    &gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">class</span>=<span class="string">"el-icon-zoom-in"</span></span></span><br><span class="line"><span class="tag">                        @<span class="attr">click</span>=<span class="string">"handleActions('zoomIn')"</span></span></span><br><span class="line"><span class="tag">                    &gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-image-viewer__actions__divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">"mode.icon"</span> @<span class="attr">click</span>=<span class="string">"toggleMode"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-image-viewer__actions__divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">class</span>=<span class="string">"el-icon-refresh-left"</span></span></span><br><span class="line"><span class="tag">                        @<span class="attr">click</span>=<span class="string">"handleActions('anticlocelise')"</span></span></span><br><span class="line"><span class="tag">                    &gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">class</span>=<span class="string">"el-icon-refresh-right"</span></span></span><br><span class="line"><span class="tag">                        @<span class="attr">click</span>=<span class="string">"handleActions('clocelise')"</span></span></span><br><span class="line"><span class="tag">                    &gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- CANVAS --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"el-image-viewer__canvas"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-for</span>=<span class="string">"(url, i) in urlList"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-show</span>=<span class="string">"i === index &amp;&amp; isImage"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">ref</span>=<span class="string">"media"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:key</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:src</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:style</span>=<span class="string">"mediaStyle"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">"el-image-viewer__img"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">load</span>=<span class="string">"handleMediaLoad"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">error</span>=<span class="string">"handleMediaError"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">mousedown</span>=<span class="string">"handleMouseDown"</span></span></span><br><span class="line"><span class="tag">                /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">video</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">controls</span>=<span class="string">"controls"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-for</span>=<span class="string">"(url, i) in urlList"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">v-show</span>=<span class="string">"i === index &amp;&amp; isVideo"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">ref</span>=<span class="string">"media"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:key</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:src</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">:style</span>=<span class="string">"mediaStyle"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">"el-image-viewer__img"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">load</span>=<span class="string">"handleMediaLoad"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">error</span>=<span class="string">"handleMediaError"</span></span></span><br><span class="line"><span class="tag">                    @<span class="attr">mousedown</span>=<span class="string">"handleMouseDown"</span></span></span><br><span class="line"><span class="tag">                &gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">import &#123; computed, ref, onMounted, watch, nextTick &#125; from 'vue'</span><br><span class="line"></span><br><span class="line">const EVENT_CODE = &#123;</span><br><span class="line">    tab: 'Tab',</span><br><span class="line">    enter: 'Enter',</span><br><span class="line">    space: 'Space',</span><br><span class="line">    left: 'ArrowLeft', // 37</span><br><span class="line">    up: 'ArrowUp', // 38</span><br><span class="line">    right: 'ArrowRight', // 39</span><br><span class="line">    down: 'ArrowDown', // 40</span><br><span class="line">    esc: 'Escape',</span><br><span class="line">    delete: 'Delete',</span><br><span class="line">    backspace: 'Backspace',</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const isFirefox = function () &#123;</span><br><span class="line">    return !!window.navigator.userAgent.match(/firefox/i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const rafThrottle = function (fn) &#123;</span><br><span class="line">    let locked = false</span><br><span class="line">    return function (...args) &#123;</span><br><span class="line">        if (locked) return</span><br><span class="line">        locked = true</span><br><span class="line">        window.requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">            fn.apply(this, args)</span><br><span class="line">            locked = false</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Mode = &#123;</span><br><span class="line">    CONTAIN: &#123;</span><br><span class="line">        name: 'contain',</span><br><span class="line">        icon: 'el-icon-full-screen',</span><br><span class="line">    &#125;,</span><br><span class="line">    ORIGINAL: &#123;</span><br><span class="line">        name: 'original',</span><br><span class="line">        icon: 'el-icon-c-scale-to-original',</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const mousewheelEventName = isFirefox() ? 'DOMMouseScroll' : 'mousewheel'</span><br><span class="line">const CLOSE_EVENT = 'close'</span><br><span class="line">const SWITCH_EVENT = 'switch'</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    name: 'MediaViewer',</span><br><span class="line">    props: &#123;</span><br><span class="line">        urlList: &#123;</span><br><span class="line">            type: Array,</span><br><span class="line">            default: () =&gt; [],</span><br><span class="line">        &#125;,</span><br><span class="line">        zIndex: &#123;</span><br><span class="line">            type: Number,</span><br><span class="line">            default: 2000,</span><br><span class="line">        &#125;,</span><br><span class="line">        initialIndex: &#123;</span><br><span class="line">            type: Number,</span><br><span class="line">            default: 0,</span><br><span class="line">        &#125;,</span><br><span class="line">        infinite: &#123;</span><br><span class="line">            type: Boolean,</span><br><span class="line">            default: true,</span><br><span class="line">        &#125;,</span><br><span class="line">        hideOnClickModal: &#123;</span><br><span class="line">            type: Boolean,</span><br><span class="line">            default: false,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    emits: [CLOSE_EVENT, SWITCH_EVENT],</span><br><span class="line">    setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">        let _keyDownHandler = null</span><br><span class="line">        let _mouseWheelHandler = null</span><br><span class="line">        let _dragHandler = null</span><br><span class="line"></span><br><span class="line">        const loading = ref(true)</span><br><span class="line">        const index = ref(props.initialIndex)</span><br><span class="line">        const wrapper = ref(null)</span><br><span class="line">        const media = ref(null)</span><br><span class="line">        const mode = ref(Mode.CONTAIN)</span><br><span class="line">        const transform = ref(&#123;</span><br><span class="line">            scale: 1,</span><br><span class="line">            deg: 0,</span><br><span class="line">            offsetX: 0,</span><br><span class="line">            offsetY: 0,</span><br><span class="line">            enableTransition: false,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        const isSingle = computed(() =&gt; &#123;</span><br><span class="line">            const &#123; urlList &#125; = props</span><br><span class="line">            return urlList.length &lt;= 1</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        const isFirst = computed(() =&gt; &#123;</span><br><span class="line">            return index.value === 0</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        const isLast = computed(() =&gt; &#123;</span><br><span class="line">            return index.value === props.urlList.length - 1</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        const currentMedia = computed(() =&gt; &#123;</span><br><span class="line">            return props.urlList[index.value]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        const isVideo = computed(() =&gt; &#123;</span><br><span class="line">            const currentUrl = props.urlList[index.value]</span><br><span class="line">            return currentUrl.endsWith('.mp4')</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        const isImage = computed(() =&gt; &#123;</span><br><span class="line">            const currentUrl = props.urlList[index.value]</span><br><span class="line">            return currentUrl.endsWith('.jpg') || currentUrl.endsWith('.png')</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        const mediaStyle = computed(() =&gt; &#123;</span><br><span class="line">            const &#123; scale, deg, offsetX, offsetY, enableTransition &#125; =</span><br><span class="line">                transform.value</span><br><span class="line">            const style = &#123;</span><br><span class="line">                transform: `scale($&#123;scale&#125;) rotate($&#123;deg&#125;deg)`,</span><br><span class="line">                transition: enableTransition ? 'transform .3s' : '',</span><br><span class="line">                marginLeft: `$&#123;offsetX&#125;px`,</span><br><span class="line">                marginTop: `$&#123;offsetY&#125;px`,</span><br><span class="line">            &#125;</span><br><span class="line">            if (mode.value.name === Mode.CONTAIN.name) &#123;</span><br><span class="line">                style.maxWidth = style.maxHeight = '100%'</span><br><span class="line">            &#125;</span><br><span class="line">            return style</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        function hide() &#123;</span><br><span class="line">            deviceSupportUninstall()</span><br><span class="line">            emit(CLOSE_EVENT)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function deviceSupportInstall() &#123;</span><br><span class="line">            _keyDownHandler = rafThrottle((e) =&gt; &#123;</span><br><span class="line">                switch (e.code) &#123;</span><br><span class="line">                    // ESC</span><br><span class="line">                    case EVENT_CODE.esc:</span><br><span class="line">                        hide()</span><br><span class="line">                        break</span><br><span class="line">                    // SPACE</span><br><span class="line">                    case EVENT_CODE.space:</span><br><span class="line">                        toggleMode()</span><br><span class="line">                        break</span><br><span class="line">                    // LEFT_ARROW</span><br><span class="line">                    case EVENT_CODE.left:</span><br><span class="line">                        prev()</span><br><span class="line">                        break</span><br><span class="line">                    // UP_ARROW</span><br><span class="line">                    case EVENT_CODE.up:</span><br><span class="line">                        handleActions('zoomIn')</span><br><span class="line">                        break</span><br><span class="line">                    // RIGHT_ARROW</span><br><span class="line">                    case EVENT_CODE.right:</span><br><span class="line">                        next()</span><br><span class="line">                        break</span><br><span class="line">                    // DOWN_ARROW</span><br><span class="line">                    case EVENT_CODE.down:</span><br><span class="line">                        handleActions('zoomOut')</span><br><span class="line">                        break</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            _mouseWheelHandler = rafThrottle((e) =&gt; &#123;</span><br><span class="line">                const delta = e.wheelDelta ? e.wheelDelta : -e.detail</span><br><span class="line">                if (delta &gt; 0) &#123;</span><br><span class="line">                    handleActions('zoomIn', &#123;</span><br><span class="line">                        zoomRate: 0.015,</span><br><span class="line">                        enableTransition: false,</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    handleActions('zoomOut', &#123;</span><br><span class="line">                        zoomRate: 0.015,</span><br><span class="line">                        enableTransition: false,</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            document.addEventListener('keydown', _keyDownHandler, false)</span><br><span class="line">            document.addEventListener(</span><br><span class="line">                mousewheelEventName,</span><br><span class="line">                _mouseWheelHandler,</span><br><span class="line">                false</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function deviceSupportUninstall() &#123;</span><br><span class="line">            document.removeEventListener('keydown', _keyDownHandler, false)</span><br><span class="line">            document.removeEventListener(</span><br><span class="line">                mousewheelEventName,</span><br><span class="line">                _mouseWheelHandler,</span><br><span class="line">                false</span><br><span class="line">            )</span><br><span class="line">            _keyDownHandler = null</span><br><span class="line">            _mouseWheelHandler = null</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function handleMediaLoad() &#123;</span><br><span class="line">            loading.value = false</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function handleMediaError(e) &#123;</span><br><span class="line">            loading.value = false</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function handleMouseDown(e) &#123;</span><br><span class="line">            if (loading.value || e.button !== 0) return</span><br><span class="line"></span><br><span class="line">            const &#123; offsetX, offsetY &#125; = transform.value</span><br><span class="line">            const startX = e.pageX</span><br><span class="line">            const startY = e.pageY</span><br><span class="line"></span><br><span class="line">            const divLeft = wrapper.value.clientLeft</span><br><span class="line">            const divRight =</span><br><span class="line">                wrapper.value.clientLeft + wrapper.value.clientWidth</span><br><span class="line">            const divTop = wrapper.value.clientTop</span><br><span class="line">            const divBottom =</span><br><span class="line">                wrapper.value.clientTop + wrapper.value.clientHeight</span><br><span class="line"></span><br><span class="line">            _dragHandler = rafThrottle((ev) =&gt; &#123;</span><br><span class="line">                transform.value = &#123;</span><br><span class="line">                    ...transform.value,</span><br><span class="line">                    offsetX: offsetX + ev.pageX - startX,</span><br><span class="line">                    offsetY: offsetY + ev.pageY - startY,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            document.addEventListener('mousemove', _dragHandler, false)</span><br><span class="line">            document.addEventListener(</span><br><span class="line">                'mouseup',</span><br><span class="line">                (e) =&gt; &#123;</span><br><span class="line">                    const mouseX = e.pageX</span><br><span class="line">                    const mouseY = e.pageY</span><br><span class="line">                    if (</span><br><span class="line">                        mouseX &lt; divLeft ||</span><br><span class="line">                        mouseX &gt; divRight ||</span><br><span class="line">                        mouseY &lt; divTop ||</span><br><span class="line">                        mouseY &gt; divBottom</span><br><span class="line">                    ) &#123;</span><br><span class="line">                        reset()</span><br><span class="line">                    &#125;</span><br><span class="line">                    document.removeEventListener(</span><br><span class="line">                        'mousemove',</span><br><span class="line">                        _dragHandler,</span><br><span class="line">                        false</span><br><span class="line">                    )</span><br><span class="line">                &#125;,</span><br><span class="line">                false</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            e.preventDefault()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function reset() &#123;</span><br><span class="line">            transform.value = &#123;</span><br><span class="line">                scale: 1,</span><br><span class="line">                deg: 0,</span><br><span class="line">                offsetX: 0,</span><br><span class="line">                offsetY: 0,</span><br><span class="line">                enableTransition: false,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function toggleMode() &#123;</span><br><span class="line">            if (loading.value) return</span><br><span class="line"></span><br><span class="line">            const modeNames = Object.keys(Mode)</span><br><span class="line">            const modeValues = Object.values(Mode)</span><br><span class="line">            const currentMode = mode.value.name</span><br><span class="line">            const index = modeValues.findIndex((i) =&gt; i.name === currentMode)</span><br><span class="line">            const nextIndex = (index + 1) % modeNames.length</span><br><span class="line">            mode.value = Mode[modeNames[nextIndex]]</span><br><span class="line">            reset()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function prev() &#123;</span><br><span class="line">            if (isFirst.value &amp;&amp; !props.infinite) return</span><br><span class="line">            const len = props.urlList.length</span><br><span class="line">            index.value = (index.value - 1 + len) % len</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function next() &#123;</span><br><span class="line">            if (isLast.value &amp;&amp; !props.infinite) return</span><br><span class="line">            const len = props.urlList.length</span><br><span class="line">            index.value = (index.value + 1) % len</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function handleActions(action, options = &#123;&#125;) &#123;</span><br><span class="line">            if (loading.value) return</span><br><span class="line">            const &#123; zoomRate, rotateDeg, enableTransition &#125; = &#123;</span><br><span class="line">                zoomRate: 0.2,</span><br><span class="line">                rotateDeg: 90,</span><br><span class="line">                enableTransition: true,</span><br><span class="line">                ...options,</span><br><span class="line">            &#125;</span><br><span class="line">            switch (action) &#123;</span><br><span class="line">                case 'zoomOut':</span><br><span class="line">                    if (transform.value.scale &gt; 0.2) &#123;</span><br><span class="line">                        transform.value.scale = parseFloat(</span><br><span class="line">                            (transform.value.scale - zoomRate).toFixed(3)</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line">                    break</span><br><span class="line">                case 'zoomIn':</span><br><span class="line">                    transform.value.scale = parseFloat(</span><br><span class="line">                        (transform.value.scale + zoomRate).toFixed(3)</span><br><span class="line">                    )</span><br><span class="line">                    break</span><br><span class="line">                case 'clocelise':</span><br><span class="line">                    transform.value.deg += rotateDeg</span><br><span class="line">                    break</span><br><span class="line">                case 'anticlocelise':</span><br><span class="line">                    transform.value.deg -= rotateDeg</span><br><span class="line">                    break</span><br><span class="line">            &#125;</span><br><span class="line">            transform.value.enableTransition = enableTransition</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        watch(currentMedia, () =&gt; &#123;</span><br><span class="line">            nextTick(() =&gt; &#123;</span><br><span class="line">                const $media = media.value</span><br><span class="line">                if (!$media.complete) &#123;</span><br><span class="line">                    loading.value = true</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        watch(index, (val) =&gt; &#123;</span><br><span class="line">            reset()</span><br><span class="line">            emit(SWITCH_EVENT, val)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        onMounted(() =&gt; &#123;</span><br><span class="line">            deviceSupportInstall()</span><br><span class="line">            // add tabindex then wrapper can be focusable via Javascript</span><br><span class="line">            // focus wrapper so arrow key can't cause inner scroll behavior underneath</span><br><span class="line">            wrapper.value?.focus?.()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        return &#123;</span><br><span class="line">            index,</span><br><span class="line">            wrapper,</span><br><span class="line">            media,</span><br><span class="line">            isSingle,</span><br><span class="line">            isFirst,</span><br><span class="line">            isLast,</span><br><span class="line">            currentMedia,</span><br><span class="line">            isImage,</span><br><span class="line">            isVideo,</span><br><span class="line">            mediaStyle,</span><br><span class="line">            mode,</span><br><span class="line">            handleActions,</span><br><span class="line">            prev,</span><br><span class="line">            next,</span><br><span class="line">            hide,</span><br><span class="line">            toggleMode,</span><br><span class="line">            handleMediaLoad,</span><br><span class="line">            handleMediaError,</span><br><span class="line">            handleMouseDown,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">MediaViewer</span></span></span><br><span class="line"><span class="tag">		<span class="attr">v-if</span>=<span class="string">"previewState.isShow"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:z-index</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:initial-index</span>=<span class="string">"previewState.index"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:url-list</span>=<span class="string">"previewState.srcList"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">:hide-on-click-modal</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">		@<span class="attr">close</span>=<span class="string">"closeViewer"</span></span></span><br><span class="line"><span class="tag">	/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>大功告成<br><img src="http://qiniu.myshuju.net/blog/images/2021/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210909154726.png" alt="展示视频"></p>
<p><img src="http://qiniu.myshuju.net/blog/images/2021/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210909154739.png" alt="展示图片"></p>
<h3 id="注意：我在里面直接用了Elment-Plus的样式，如果要单独使用还得把这些样式也给提取出来，因为是scss我的项目没有用，要提取有点麻烦而且我本来就用的Element-Plus，就没弄"><a href="#注意：我在里面直接用了Elment-Plus的样式，如果要单独使用还得把这些样式也给提取出来，因为是scss我的项目没有用，要提取有点麻烦而且我本来就用的Element-Plus，就没弄" class="headerlink" title="注意：我在里面直接用了Elment Plus的样式，如果要单独使用还得把这些样式也给提取出来，因为是scss我的项目没有用，要提取有点麻烦而且我本来就用的Element Plus，就没弄"></a>注意：我在里面直接用了Elment Plus的样式，如果要单独使用还得把这些样式也给提取出来，因为是scss我的项目没有用，要提取有点麻烦而且我本来就用的Element Plus，就没弄</h3>
        </section>
    </article>
    
        <!-- disqus 评论框 start -->
        <div class="comment">
            <div id="disqus_thread" class="disqus-thread">
              <i>加载评论框需要翻墙</i>
            </div>
        </div>
        <!-- disqus 评论框 end -->
    
    
        <!-- livere 评论框 start -->
        <div class="comment">
            <div id="lv-container" data-id="city" data-uid="your_livere_uid"></div>
        </div>
        <!-- livere 评论框 end -->
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#注意：我在里面直接用了Elment-Plus的样式，如果要单独使用还得把这些样式也给提取出来，因为是scss我的项目没有用，要提取有点麻烦而且我本来就用的Element-Plus，就没弄"><span class="toc-number">1.</span> <span class="toc-text">注意：我在里面直接用了Elment Plus的样式，如果要单独使用还得把这些样式也给提取出来，因为是scss我的项目没有用，要提取有点麻烦而且我本来就用的Element Plus，就没弄</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>

<!-- disqus 公共JS代码 -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = "zxhm";
  var disqus_identifier = "http://zxhm.me/2021/VUE3预览图片和视频/";
  var disqus_url = "http://zxhm.me/2021/VUE3预览图片和视频/";

  isAgent(getDisqus)

  // determine user agent in China
  function isAgent(cb) {
    var url = '//graph.facebook.com/feed?callback=h';
    var xhr = new XMLHttpRequest();
    var called = false;
    xhr.open('GET', url);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
      called = true;
      cb(true);
      }
    };
    xhr.send();
    // timeout 1s, this facebook API is very fast.
    setTimeout(function() {
      if (!called) {
      xhr.abort();
      cb(false)
      }
    }, 1000);
  }

  function getDisqus(isAgent) {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; 
    dsq.async = true
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq)
  }
</script>
<!-- disqus 公共JS代码 end -->


<script type="text/javascript">
  (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>


  <footer>
  <div class="copyright">
    <div>
      &copy; 2021 | Powered by <a href="https://www.myshuju.net" target="_blank">Andy Zhang</a>&nbsp
    </div>
    <!-- <div>
      Write by <a href="http://www.zxhm.me" target="_blank">Zxhm</a>
    </div> -->
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="/lib/jquery.fancybox.min.js"></script>


</body>
</html>
